<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>로그인</title>
    <link rel="stylesheet" th:href="@{/css/login.css}">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="login-wrapper"> <!--outermost box -->
        
        <div class="login-box"> <!-- Funtion box -->
            <div class="login-header">로그인</div>
            <div class="typing-box">
                <div class="empx"><span>이메일</span></div>
                <div class="typing-email dass1">
                    <input type="text" name="email" required>
                </div>
                <div class="typing-password dass1">
                    <div class="empx"><span>비밀번호</span></div>
                    <div><input type="password" name="password" required></div>
                </div>
            </div>
            <div class="find-box">
                <a href="/auth/find-account">아이디 찾기</a> | <a href="/auth/change-pw">비밀번호 찾기</a>
            </div>
            <div class="submit-box">
                <button id="loginButton" class="submit">로그인</button>
            </div>
            <div class="login-bottom">
                <div class="joinUs">아직 회원이 아니신가요? | <a href="/auth/signup/agree">회원가입하기</a></div>
            </div>
            <div class="login-bottom">
                <div class="login-line">소셜 아이디로 로그인</div>
            </div>
            <div class="login-bottom socal-login">
                <div>
                    <a id="login-kakao" href="/oauth2/authorization/kakao">카카오</a>
                    <a id="login-naver" href="/oauth2/authorization/naver">네이버</a>
                    <a id="login-google" href="/oauth2/authorization/google">구글</a>
                </div>
            </div>
        </div>
    </div>
    <script>
        document.getElementById('loginButton').addEventListener('click', function() {
            var email = document.getElementsByName('email')[0].value;
            var password = document.getElementsByName('password')[0].value;

            //LoginRequest 객체 생성
            const loginReq = {
                email: email,
                password: password
            };

            //로그인 요청을 보냄
            axios.post('/auth/login', loginReq)
                .then(function(response) {
                    //서버 응답 처리
                    console.log(response);
                    alert('로그인 성공!');

                    //서버에서 반환한 토큰을 로컬 스토리지에 저장
                    const data = response.data;
                    localStorage.setItem('accessToken', data.accessToken);
                    localStorage.setItem('refreshToken', data.refreshToken);
                    localStorage.setItem('expiresIn', data.accessTokenExpiresIn);
                })
                .catch(function(error) {
                    //오류 처리
                    console.error('로그인 실패:', error);
                    alert('로그인에 실패했습니다. 이메일과 비밀번호를 확인하세요.');
                });
        });
    </script>
</body>
</html>