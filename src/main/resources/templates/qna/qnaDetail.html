<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/common/default.css">
    <link rel="stylesheet" href="/css/qna/qnaDetail.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- 전체 폰트 -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hahmlet:wght@100..900&display=swap" rel="stylesheet">
    <!-- 구글 아이콘 -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <title>QnADetail</title>
    <!-- axios -->
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>
</head>
<body>
<!-- header 영역 참조 -->
<header th:insert="~{/header :: header}"></header>

<div class="QnADetail-wrapper page-content">
    <div class="QnADetail-contBox contbox">
        <div class="QnAHeader-wrapper">
            <input type="hidden" id="qnaId" value="${qnaId}">
            <div class="D-left-box"><img src="https://cdn4.iconfinder.com/data/icons/christmas-special/512/renne.png" width="55" height="55"></div>
            <div class="D-right-box">
                <p class="D-top"></p>
                <div class="D-bottom">
                    <p class="D-date"></p>
                    <span>|</span>
                    <p class="D-viewCount"><span class="material-symbols-outlined">visibility</span><span class="viewCount-num"></span></p>
                </div>
            </div>
        </div>
        <div class="D-titleBox">
            <p class="D-title"></p>
            <button class="answer-comp btn bs1"></button>
        </div>
        <div class="D-textarea">
            <p></p>
        </div>
        <div class="D-answer" style="display:none;"><button class="btn-answer btn bc4">답변작성하기</button></div>
    </div>
</div>

<script>
    /*QnA 상세 조회*/
    function loadQnaDetail() {
        var qnaId = [[${qnaId}]];
        console.log(qnaId);

        axios.get(`/qna/${qnaId}`)
            .then(function(response) {
                var qnaDetail = response.data;

                var titleElement = document.querySelector('.D-title');
                var nicknameElement = document.querySelector('.D-top');
                var createDateElement = document.querySelector('.D-date');
                var viewCountElement = document.querySelector('.viewCount-num');
                var contentElement = document.querySelector('.D-textarea p');

                //데이터 넣기
                nicknameElement.textContent = qnaDetail.nickname;
                createDateElement.textContent = qnaDetail.createDate;
                viewCountElement.textContent = qnaDetail.viewCount;
                titleElement.textContent = qnaDetail.title;
                contentElement.textContent = qnaDetail.content;

                //답변 상태에 따라 버튼 스타일 설정
                var answerButton = document.querySelector('.answer-comp');
                answerButton.classList.add(qnaDetail.qnaCheck === 'CHECKING' ? 'bc3' : 'bc7');
                answerButton.textContent = qnaDetail.qnaCheck === 'CHECKING' ? '확인 중' : '답변 완료';
            })
            .catch(function(error) {
                console.error(error);
                alert('QnA를 불러오지 못했습니다.');
            });
    }

    function showAnswerBtnForAdmin() {
        //payload에서 데이터 가져오기
        const payload = getPayloadData();

        //권한이 관리자이면 답변 작성 버튼 보이기
        if (payload.auth == "ADMIN") {
            document.querySelector('.D-answer').style.display = 'block';
        }
        const exp = payload.exp;    //토큰 만료 시간
    }

    //QnA 상세 조회 함수 실행
    loadQnaDetail();
    showAnswerBtnForAdmin();
</script>
</body>
</html>