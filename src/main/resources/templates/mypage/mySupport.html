<!DOCTYPE html>
<html lang="kr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>나의 후원 목록</title>
</head>
<body>
<!-- header 영역 참조 -->
<header th:insert="~{/common/header :: header}"></header>

<div class="supportList-wrapper page-content">
    <!-- mypageMenu 영역 참조 -->
    <div th:insert="~{mypage/mypageMenu :: mypageMenu}"></div>

    <div class="list-wrapper mypage-detail">
        <div class="supportList-top list-top">
            <div class="list-title">나의 후원 목록</div>
            <table id="supportTable">
                <tr>
                    <th class="th-id">No</th>
                    <th>제목</th>
                    <th class="th-amount">목표 금액</th>
                    <th class="th-amount">모인 금액</th>
                    <th class="th-create-date">작성일</th>
                    <th class="th-status">상태</th>
                </tr>
                <tbody id="supportTableBody">
            </table>
            <div class="w3-center">
                <ul id="pagination" class="w3-pagination"></ul>
            </div>
        </div>
        <div class="list-bottom">
        </div>
    </div>
</div>

<!-- footer 영역 참조 -->
<footer th:insert="~{/common/footer :: footer}"></footer>

<script th:src="@{/js/common/pagination.js}"></script>
<script>
   /*나의 후원 목록 조회*/
   loadList(0);

   //Support 목록을 테이블에 표시하는 함수
   function loadList(pageNo) {
       axios.get(`/member/support-detail`, {
           headers: {
               'Authorization': 'Bearer ' + token
           },
            params: {
                pageNo: pageNo
            }
       }).then(function (response) {
           //서버로부터 받은 데이터를 테이블에 추가
           var supportList = response.data.content;
           var tableBody = document.querySelector('#supportTableBody');

           //DocumentFragment 생성
           var fragment = new DocumentFragment();

           supportList.forEach(function (support) {
               var row = `<tr>
                           <td>${support.supportId}</td>
                           <td><a href="/support/detail/${support.supportId}" class="title-hover">${support.title}</a></td>
                           <td>${support.goalAmount}</td>
                           <td>${support.supportAmount}</td>
                           <td>${support.createDate}</td>
                           <td><button class="answer-btn btn bs1 bc3}" style="cursor: default;">${support.supportStatus === 'START' ? '후원 시작' : support.supportStatus === 'SUPPORTING' ? '후원중' : '후원 종료'}</button></td>
                       </tr>`;
                var tr = document.createElement('tr');
                tr.innerHTML = row;

                fragment.appendChild(tr);
           });

            //테이블 내용을 한 번에 추가
            tableBody.innerHTML = '';
            tableBody.appendChild(fragment);

           //페이지 내비게이션 업데이트
           renderPagination(response.data.totalPages, pageNo);
       })
       .catch(function (error) {
           console.error(error);
       });
   }
</script>
</body>
</html>