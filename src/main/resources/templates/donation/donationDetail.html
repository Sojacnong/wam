<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" th:href="@{/css/donation/donationDetail.css}">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <!-- iamport.payment.js -->
    <script type="text/javascript" th:src="@{https://cdn.iamport.kr/js/iamport.payment-1.2.0.js}"></script>
    <title>donationDetail</title>
<body>
<!-- header 영역 참조 -->
<header th:insert="~{/common/header :: header}"></header>

<div class="donationDetail-wrapper page-content">
    <div class="contBox">
        <div class="detail-header">
            <div class="donation-title"></div>
            <div class="header-line"></div>
        </div>
        <div class="detail-body-1">
            <div class="body1-wrapper">
                <input type="hidden" id="supportId" value="">
                <div class="donation-img-box">
                    <div class="donation-status start">후원 시작</div>
                    <div class="donation-img"><img src="#" class="first-pic" alt="animal"></div>
                </div>
                <div class="deadline">
                    <span class="bold">후원기간</span>
                    <span class="start-date"></span><span>~</span><span class="end-date"></span>
                </div>
                <div class="amount">
                    <div class="donation-tag">
                        <div id="mml" class="tag-name home-btn"></div>
                    </div>
                    <div class="donation-amount">
                        <p class="donation-amount"><span></span> 원</p>
                        <p class="goal-amount">목표 금액 <span></span>원</p>
                    </div>
                </div>
                <div class="bottomline">
                    <div class="bottomline-left">
                        <div class="donation-icon"><span id="likeBtn" class="material-symbols-outlined" onclick="toggleLike()">favorite</span><span class="like-count"></span></div>
                        <span> | </span>
                        <div class="donation-icon"><span class="material-symbols-outlined">share</span><span>공유하기</span></div>
                    </div>
                    <div class="bottomline-right">
                        <a id="impKey" th:href="${@environment.getProperty('imp.code')}"></a>
                        <button class="support-btn btn bc5" onclick="promptAmount()">후원하기</button>
                    </div>
                </div>
            </div>
        </div>
        <div class="detail-body-2">
            <div class="body2-wrapper"></div>
        </div>
        <div class="detail-body-3">
            <div class="body3-wrapper">
                <div class="CommentWrite">
                    <p>댓글 작성하기</p>
                    <div class="C-textarea">
                        <textarea class="comment-content input-form" placeholder="응원의 메세지를 남겨주세요."></textarea>
                    </div>
                    <div class="C-btnBox"><button id="createCommentBtn" class="C-btn btn bc2">등록</button></div>
                </div>
                <div class="CommentList">
                    <div class="C-listHeader">
                        <p>댓글</p><span class="comment-count"></span>
                    </div>
                    <div class="comment-list">
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- footer 영역 참조 -->
<footer th:insert="~{/common/footer :: footer}"></footer>

<script th:src="@{/js/donation/payment.js}"></script>
<script th:src="@{/js/donation/comment.js}"></script>
<script th:src="@{/js/donation/like.js}"></script>
<script>
    /*후원 상세 조회*/
    document.addEventListener('DOMContentLoaded', function() {
        const supportId = [[${supportId}]];
        console.log(supportId);

        //좋아요 상태 확인
        checkLikeStatus(supportId);

        axios.get(`/support/${supportId}`)
            .then(function(response) {
                const supportDetail = response.data;

                document.querySelector('#supportId').value = supportId;
                document.querySelector('.donation-title').textContent = supportDetail.title;
                document.querySelector('.donation-img img').src = supportDetail.firstImg;
                document.querySelector('.start-date').textContent = supportDetail.startDate;
                document.querySelector('.end-date').textContent = supportDetail.endDate;
                document.querySelector('.tag-name').textContent = '#'+supportDetail.animalSubjects;
                document.querySelector('.donation-amount span').textContent = supportDetail.supportAmount;
                document.querySelector('.goal-amount span').textContent = supportDetail.goalAmount;
                document.querySelector('.like-count').textContent = supportDetail.supportLike;
                document.querySelector('.body2-wrapper').textContent = supportDetail.content;
                document.querySelector('.comment-count').textContent = supportDetail.comments.length;

                //댓글
                const commentList = document.querySelector('.comment-list');
                commentList.innerHTML = '';
                supportDetail.comments.forEach(function(comment) {
                    const commentBox = document.createElement('div');
                    commentBox.classList.add('commentBox');
                    commentBox.innerHTML = `
                        <div class="commentBox-R"><img src="https://cdn4.iconfinder.com/data/icons/christmas-special/512/renne.png" width="55" height="55"></div>
                        <div class="commentBox-L">
                            <div class="commentBox-LT">
                                <div class="edit-box">
                                    <input type="hidden" class="commentId" value="${comment.commentId}">
                                    <div class="delete-comment-btn">삭제하기</div>
                                </div>
                                <div class="commentBox-LTR comment-nickname">${comment.nickname}</div>
                                <div class="commentBox-LTL">
                                    <span class="material-symbols-outlined">more_horiz</span>
                                </div>
                            </div>
                            <div class="commentBox-LM"><p class="comment-content">${comment.content}</p></div>
                            <div class="commentBox-LB"><span class="comment-date gray-text">${comment.createDate}</span></div>
                        </div>`;
                    commentList.appendChild(commentBox);
                });

                //댓글 삭제
                deleteComment(supportId);

            })
            .catch(function(error) {
                console.error(error);
            });
    });
</script>
</body>
</html>